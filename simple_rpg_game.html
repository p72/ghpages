<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプルRPG冒険記</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .game-header h1 {
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin: 0;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
        }
        
        .player-stats {
            margin-bottom: 20px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
        }
        
        .stat-bar {
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }
        
        .hp-bar {
            background: linear-gradient(90deg, #ff0000, #ff6666);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .mp-bar {
            background: linear-gradient(90deg, #0066ff, #6699ff);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .exp-bar {
            background: linear-gradient(90deg, #ffaa00, #ffdd66);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .inventory {
            margin-top: 20px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #666;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .inventory-slot:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }
        
        .inventory-slot.has-item {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.2);
        }
        
        .story-text {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            line-height: 1.6;
            min-height: 100px;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .choice-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .choice-btn:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .choice-btn:active {
            transform: translateY(0);
        }
        
        .choice-btn.danger {
            background: linear-gradient(45deg, #f44336, #da190b);
        }
        
        .choice-btn.danger:hover {
            background: linear-gradient(45deg, #da190b, #f44336);
        }
        
        .battle-area {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .enemy-info {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .enemy-hp-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 15px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .enemy-hp {
            background: linear-gradient(90deg, #ff4444, #ff8888);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .battle-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-damage {
            color: #ff6666;
        }
        
        .log-heal {
            color: #66ff66;
        }
        
        .log-exp {
            color: #ffdd66;
        }
        
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>🗡️ RPG冒険記 ⚔️</h1>
        </div>
        
        <div class="game-area">
            <div class="main-content">
                <div id="gameContent">
                    <div class="story-text" id="storyText">
                        ようこそ、勇敢な冒険者よ！<br>
                        あなたは小さな村の近くで目を覚ました。村人たちは恐ろしいモンスターに悩まされているようだ。<br>
                        あなたの冒険が今、始まる...
                    </div>
                    
                    <div class="choices" id="choices">
                        <button class="choice-btn" onclick="startExploration()">🌲 森を探索する</button>
                        <button class="choice-btn" onclick="visitShop()">🏪 村の店を訪れる</button>
                        <button class="choice-btn" onclick="restAtInn()">🏠 宿屋で休む</button>
                    </div>
                </div>
                
                <div class="log" id="gameLog">
                    <div class="log-entry">ゲームが始まりました。頑張って！</div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="player-stats">
                    <h3>💪 プレイヤー情報</h3>
                    <div>名前: <span id="playerName">勇者</span></div>
                    <div>レベル: <span id="playerLevel">1</span></div>
                    <div>ゴールド: <span id="playerGold">100</span>G</div>
                    
                    <div style="margin-top: 10px;">
                        <div>HP: <span id="playerHP">100</span>/<span id="playerMaxHP">100</span></div>
                        <div class="stat-bar">
                            <div class="hp-bar" id="hpBar" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div>MP: <span id="playerMP">50</span>/<span id="playerMaxMP">50</span></div>
                        <div class="stat-bar">
                            <div class="mp-bar" id="mpBar" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div>EXP: <span id="playerEXP">0</span>/<span id="playerMaxEXP">100</span></div>
                        <div class="stat-bar">
                            <div class="exp-bar" id="expBar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <div>攻撃力: <span id="playerAttack">15</span></div>
                        <div>防御力: <span id="playerDefense">5</span></div>
                    </div>
                </div>
                
                <div class="inventory">
                    <h3>🎒 アイテム</h3>
                    <div class="inventory-grid" id="inventoryGrid">
                        <!-- アイテムスロットは動的に生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ゲーム状態管理
        let gameState = {
            player: {
                name: "勇者",
                level: 1,
                hp: 100,
                maxHP: 100,
                mp: 50,
                maxMP: 50,
                exp: 0,
                maxEXP: 100,
                attack: 15,
                defense: 5,
                gold: 100
            },
            inventory: [
                { name: "回復薬", emoji: "🧪", count: 3, type: "heal", value: 50 },
                { name: "魔法薬", emoji: "💙", count: 2, type: "mana", value: 30 }
            ],
            currentEnemy: null,
            inBattle: false,
            gameLog: []
        };

        // ゲーム初期化
        function initGame() {
            updatePlayerStats();
            updateInventory();
            addLog("新たな冒険が始まった！");
        }

        // ログ追加
        function addLog(message, type = "") {
            gameState.gameLog.push({ message, type, time: Date.now() });
            const logElement = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
            
            // ログが多すぎる場合は古いものを削除
            if (logElement.children.length > 20) {
                logElement.removeChild(logElement.firstChild);
            }
        }

        // プレイヤー統計更新
        function updatePlayerStats() {
            const player = gameState.player;
            document.getElementById('playerName').textContent = player.name;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('playerGold').textContent = player.gold;
            document.getElementById('playerHP').textContent = player.hp;
            document.getElementById('playerMaxHP').textContent = player.maxHP;
            document.getElementById('playerMP').textContent = player.mp;
            document.getElementById('playerMaxMP').textContent = player.maxMP;
            document.getElementById('playerEXP').textContent = player.exp;
            document.getElementById('playerMaxEXP').textContent = player.maxEXP;
            document.getElementById('playerAttack').textContent = player.attack;
            document.getElementById('playerDefense').textContent = player.defense;

            // ステータスバー更新
            document.getElementById('hpBar').style.width = (player.hp / player.maxHP * 100) + '%';
            document.getElementById('mpBar').style.width = (player.mp / player.maxMP * 100) + '%';
            document.getElementById('expBar').style.width = (player.exp / player.maxEXP * 100) + '%';
        }

        // インベントリ更新
        function updateInventory() {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = '';
            
            // 9スロット作成
            for (let i = 0; i < 9; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                
                if (i < gameState.inventory.length) {
                    const item = gameState.inventory[i];
                    slot.className += ' has-item';
                    slot.innerHTML = `${item.emoji}<br><small>${item.count}</small>`;
                    slot.title = item.name;
                    slot.onclick = () => useItem(i);
                }
                
                grid.appendChild(slot);
            }
        }

        // アイテム使用
        function useItem(index) {
            const item = gameState.inventory[index];
            if (!item) return;
            
            const player = gameState.player;
            
            if (item.type === 'heal' && player.hp < player.maxHP) {
                const healAmount = Math.min(item.value, player.maxHP - player.hp);
                player.hp += healAmount;
                addLog(`${item.name}を使用！HPが${healAmount}回復した！`, 'log-heal');
                
                item.count--;
                if (item.count <= 0) {
                    gameState.inventory.splice(index, 1);
                }
                
                updatePlayerStats();
                updateInventory();
            } else if (item.type === 'mana' && player.mp < player.maxMP) {
                const manaAmount = Math.min(item.value, player.maxMP - player.mp);
                player.mp += manaAmount;
                addLog(`${item.name}を使用！MPが${manaAmount}回復した！`, 'log-heal');
                
                item.count--;
                if (item.count <= 0) {
                    gameState.inventory.splice(index, 1);
                }
                
                updatePlayerStats();
                updateInventory();
            } else {
                addLog("今は使用できません。");
            }
        }

        // 経験値獲得とレベルアップ
        function gainExp(amount) {
            gameState.player.exp += amount;
            addLog(`経験値を${amount}獲得した！`, 'log-exp');
            
            if (gameState.player.exp >= gameState.player.maxEXP) {
                levelUp();
            }
            
            updatePlayerStats();
        }

        function levelUp() {
            const player = gameState.player;
            player.level++;
            player.exp -= player.maxEXP;
            player.maxEXP = Math.floor(player.maxEXP * 1.2);
            
            const hpIncrease = Math.floor(Math.random() * 20) + 10;
            const mpIncrease = Math.floor(Math.random() * 10) + 5;
            const attackIncrease = Math.floor(Math.random() * 5) + 2;
            const defenseIncrease = Math.floor(Math.random() * 3) + 1;
            
            player.maxHP += hpIncrease;
            player.hp = player.maxHP; // レベルアップ時に全回復
            player.maxMP += mpIncrease;
            player.mp = player.maxMP;
            player.attack += attackIncrease;
            player.defense += defenseIncrease;
            
            addLog(`🎉 レベルアップ！レベル${player.level}になった！`, 'log-exp');
            addLog(`HP+${hpIncrease}, MP+${mpIncrease}, 攻撃力+${attackIncrease}, 防御力+${defenseIncrease}`);
        }

        // 探索開始
        function startExploration() {
            const events = [
                { type: 'battle', chance: 0.4 },
                { type: 'treasure', chance: 0.3 },
                { type: 'nothing', chance: 0.3 }
            ];
            
            const random = Math.random();
            let currentChance = 0;
            
            for (const event of events) {
                currentChance += event.chance;
                if (random <= currentChance) {
                    handleEvent(event.type);
                    break;
                }
            }
        }

        // イベント処理
        function handleEvent(eventType) {
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            switch (eventType) {
                case 'battle':
                    startBattle();
                    break;
                    
                case 'treasure':
                    const goldFound = Math.floor(Math.random() * 50) + 10;
                    gameState.player.gold += goldFound;
                    storyText.innerHTML = `✨ 宝箱を発見した！<br>${goldFound}ゴールドを手に入れた！`;
                    addLog(`宝箱から${goldFound}ゴールドを獲得！`);
                    
                    choices.innerHTML = `
                        <button class="choice-btn" onclick="startExploration()">🔍 さらに探索する</button>
                        <button class="choice-btn" onclick="returnToVillage()">🏠 村に戻る</button>
                    `;
                    updatePlayerStats();
                    break;
                    
                case 'nothing':
                    storyText.innerHTML = `🌲 森の中を歩き回ったが、特に何も見つからなかった。<br>鳥のさえずりが聞こえる...`;
                    choices.innerHTML = `
                        <button class="choice-btn" onclick="startExploration()">🔍 さらに探索する</button>
                        <button class="choice-btn" onclick="returnToVillage()">🏠 村に戻る</button>
                    `;
                    break;
            }
        }

        // バトル開始
        function startBattle() {
            const enemies = [
                { name: "スライム", emoji: "🟢", hp: 30, maxHP: 30, attack: 8, defense: 2, exp: 15, gold: 20 },
                { name: "ゴブリン", emoji: "👹", hp: 50, maxHP: 50, attack: 12, defense: 4, exp: 25, gold: 35 },
                { name: "オーク", emoji: "🧌", hp: 80, maxHP: 80, attack: 18, defense: 8, exp: 40, gold: 60 }
            ];
            
            gameState.currentEnemy = enemies[Math.floor(Math.random() * enemies.length)];
            gameState.inBattle = true;
            
            addLog(`${gameState.currentEnemy.emoji} ${gameState.currentEnemy.name}が現れた！`);
            updateBattleUI();
        }

        // バトルUI更新
        function updateBattleUI() {
            const enemy = gameState.currentEnemy;
            const gameContent = document.getElementById('gameContent');
            
            gameContent.innerHTML = `
                <div class="battle-area">
                    <div class="enemy-info">
                        <h2>${enemy.emoji} ${enemy.name}</h2>
                        <div>HP: ${enemy.hp}/${enemy.maxHP}</div>
                        <div class="enemy-hp-bar">
                            <div class="enemy-hp" style="width: ${(enemy.hp / enemy.maxHP * 100)}%"></div>
                        </div>
                    </div>
                    
                    <div class="battle-actions">
                        <button class="choice-btn" onclick="playerAttack()">⚔️ 攻撃</button>
                        <button class="choice-btn" onclick="castMagic()">✨ 魔法</button>
                        <button class="choice-btn" onclick="tryRun()">🏃 逃げる</button>
                        <button class="choice-btn" onclick="defend()">🛡️ 防御</button>
                    </div>
                </div>
            `;
        }

        // プレイヤー攻撃
        function playerAttack() {
            const player = gameState.player;
            const enemy = gameState.currentEnemy;
            
            const damage = Math.max(1, player.attack - enemy.defense + Math.floor(Math.random() * 10) - 5);
            enemy.hp -= damage;
            
            addLog(`${enemy.name}に${damage}のダメージを与えた！`, 'log-damage');
            
            if (enemy.hp <= 0) {
                winBattle();
            } else {
                enemyAttack();
            }
        }

        // 魔法攻撃
        function castMagic() {
            const player = gameState.player;
            const enemy = gameState.currentEnemy;
            
            if (player.mp < 10) {
                addLog("MPが足りません！");
                enemyAttack();
                return;
            }
            
            player.mp -= 10;
            const damage = Math.floor(player.attack * 1.5) + Math.floor(Math.random() * 15);
            enemy.hp -= damage;
            
            addLog(`ファイアボールで${enemy.name}に${damage}のダメージ！`, 'log-damage');
            updatePlayerStats();
            
            if (enemy.hp <= 0) {
                winBattle();
            } else {
                enemyAttack();
            }
        }

        // 防御
        function defend() {
            addLog("防御の構えを取った！");
            enemyAttack(true);
        }

        // 逃走試行
        function tryRun() {
            if (Math.random() < 0.7) {
                addLog("うまく逃げることができた！");
                gameState.inBattle = false;
                returnToVillage();
            } else {
                addLog("逃げることができなかった！");
                enemyAttack();
            }
        }

        // 敵の攻撃
        function enemyAttack(defending = false) {
            const player = gameState.player;
            const enemy = gameState.currentEnemy;
            
            let damage = Math.max(1, enemy.attack - player.defense + Math.floor(Math.random() * 6) - 3);
            if (defending) damage = Math.floor(damage / 2);
            
            player.hp -= damage;
            addLog(`${enemy.name}の攻撃！${damage}のダメージを受けた！`, 'log-damage');
            
            if (player.hp <= 0) {
                gameOver();
            } else {
                updatePlayerStats();
                updateBattleUI();
            }
        }

        // バトル勝利
        function winBattle() {
            const enemy = gameState.currentEnemy;
            gameState.inBattle = false;
            
            addLog(`${enemy.name}を倒した！`);
            gameState.player.gold += enemy.gold;
            addLog(`${enemy.gold}ゴールドを獲得した！`);
            gainExp(enemy.exp);
            
            // アイテムドロップ判定
            if (Math.random() < 0.3) {
                const items = [
                    { name: "回復薬", emoji: "🧪", type: "heal", value: 50 },
                    { name: "魔法薬", emoji: "💙", type: "mana", value: 30 }
                ];
                const droppedItem = items[Math.floor(Math.random() * items.length)];
                
                // インベントリに追加
                const existingItem = gameState.inventory.find(item => item.name === droppedItem.name);
                if (existingItem) {
                    existingItem.count++;
                } else {
                    gameState.inventory.push({...droppedItem, count: 1});
                }
                
                addLog(`${droppedItem.emoji} ${droppedItem.name}を手に入れた！`);
                updateInventory();
            }
            
            updatePlayerStats();
            returnToVillage();
        }

        // ゲームオーバー
        function gameOver() {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <div class="story-text">
                    💀 ゲームオーバー 💀<br>
                    あなたは力尽きてしまった...<br>
                    しかし、冒険者の魂は不滅だ！
                </div>
                <div class="choices">
                    <button class="choice-btn" onclick="restartGame()">🔄 もう一度始める</button>
                </div>
            `;
        }

        // ゲーム再開
        function restartGame() {
            gameState.player.hp = gameState.player.maxHP;
            gameState.player.mp = gameState.player.maxMP;
            gameState.inBattle = false;
            gameState.currentEnemy = null;
            
            addLog("村の賢者によって蘇生された！");
            returnToVillage();
        }

        // 村に戻る
        function returnToVillage() {
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            storyText.innerHTML = `🏘️ 村に戻ってきた。<br>村人たちが温かく迎えてくれる。次はどうしようか？`;
            
            choices.innerHTML = `
                <button class="choice-btn" onclick="startExploration()">🌲 森を探索する</button>
                <button class="choice-btn" onclick="visitShop()">🏪 村の店を訪れる</button>
                <button class="choice-btn" onclick="restAtInn()">🏠 宿屋で休む</button>
            `;
        }

        // 店を訪問
        function visitShop() {
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            storyText.innerHTML = `👴 店主：「いらっしゃい！何か必要なものはあるかい？」<br>
                                  回復薬: 30G | 魔法薬: 40G | 現在の所持金: ${gameState.player.gold}G`;
            
            choices.innerHTML = `
                <button class="choice-btn" onclick="buyItem('heal', 30)">🧪 回復薬を買う (30G)</button>
                <button class="choice-btn" onclick="buyItem('mana', 40)">💙 魔法薬を買う (40G)</button>
                <button class="choice-btn" onclick="returnToVillage()">🚪 店を出る</button>
            `;
        }

        // アイテム購入
        function buyItem(type, cost) {
            if (gameState.player.gold < cost) {
                addLog("ゴールドが足りません！");
                return;
            }
            
            gameState.player.gold -= cost;
            
            const items = {
                heal: { name: "回復薬", emoji: "🧪", type: "heal", value: 50 },
                mana: { name: "魔法薬", emoji: "💙", type: "mana", value: 30 }
            };
            
            const item = items[type];
            const existingItem = gameState.inventory.find(i => i.name === item.name);
            
            if (existingItem) {
                existingItem.count++;
            } else {
                gameState.inventory.push({...item, count: 1});
            }
            
            addLog(`${item.emoji} ${item.name}を購入した！`);
            updatePlayerStats();
            updateInventory();
            visitShop(); // 店画面を更新
        }

        // 宿屋で休む
        function restAtInn() {
            const cost = 20;
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            if (gameState.player.gold >= cost) {
                storyText.innerHTML = `🛏️ 宿屋の女将：「一晩20ゴールドになります。ゆっくりお休みください。