<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«RPGå†’é™ºè¨˜</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .game-header h1 {
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin: 0;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
        }
        
        .player-stats {
            margin-bottom: 20px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
        }
        
        .stat-bar {
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }
        
        .hp-bar {
            background: linear-gradient(90deg, #ff0000, #ff6666);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .mp-bar {
            background: linear-gradient(90deg, #0066ff, #6699ff);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .exp-bar {
            background: linear-gradient(90deg, #ffaa00, #ffdd66);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .inventory {
            margin-top: 20px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #666;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .inventory-slot:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }
        
        .inventory-slot.has-item {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.2);
        }
        
        .story-text {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            line-height: 1.6;
            min-height: 100px;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .choice-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .choice-btn:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .choice-btn:active {
            transform: translateY(0);
        }
        
        .choice-btn.danger {
            background: linear-gradient(45deg, #f44336, #da190b);
        }
        
        .choice-btn.danger:hover {
            background: linear-gradient(45deg, #da190b, #f44336);
        }
        
        .battle-area {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .enemy-info {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .enemy-hp-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 15px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .enemy-hp {
            background: linear-gradient(90deg, #ff4444, #ff8888);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .battle-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-damage {
            color: #ff6666;
        }
        
        .log-heal {
            color: #66ff66;
        }
        
        .log-exp {
            color: #ffdd66;
        }
        
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸ—¡ï¸ RPGå†’é™ºè¨˜ âš”ï¸</h1>
        </div>
        
        <div class="game-area">
            <div class="main-content">
                <div id="gameContent">
                    <div class="story-text" id="storyText">
                        ã‚ˆã†ã“ãã€å‹‡æ•¢ãªå†’é™ºè€…ã‚ˆï¼<br>
                        ã‚ãªãŸã¯å°ã•ãªæ‘ã®è¿‘ãã§ç›®ã‚’è¦šã¾ã—ãŸã€‚æ‘äººãŸã¡ã¯æã‚ã—ã„ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã«æ‚©ã¾ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ã€‚<br>
                        ã‚ãªãŸã®å†’é™ºãŒä»Šã€å§‹ã¾ã‚‹...
                    </div>
                    
                    <div class="choices" id="choices">
                        <button class="choice-btn" onclick="startExploration()">ğŸŒ² æ£®ã‚’æ¢ç´¢ã™ã‚‹</button>
                        <button class="choice-btn" onclick="visitShop()">ğŸª æ‘ã®åº—ã‚’è¨ªã‚Œã‚‹</button>
                        <button class="choice-btn" onclick="restAtInn()">ğŸ  å®¿å±‹ã§ä¼‘ã‚€</button>
                    </div>
                </div>
                
                <div class="log" id="gameLog">
                    <div class="log-entry">ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚é ‘å¼µã£ã¦ï¼</div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="player-stats">
                    <h3>ğŸ’ª ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±</h3>
                    <div>åå‰: <span id="playerName">å‹‡è€…</span></div>
                    <div>ãƒ¬ãƒ™ãƒ«: <span id="playerLevel">1</span></div>
                    <div>ã‚´ãƒ¼ãƒ«ãƒ‰: <span id="playerGold">100</span>G</div>
                    
                    <div style="margin-top: 10px;">
                        <div>HP: <span id="playerHP">100</span>/<span id="playerMaxHP">100</span></div>
                        <div class="stat-bar">
                            <div class="hp-bar" id="hpBar" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div>MP: <span id="playerMP">50</span>/<span id="playerMaxMP">50</span></div>
                        <div class="stat-bar">
                            <div class="mp-bar" id="mpBar" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div>EXP: <span id="playerEXP">0</span>/<span id="playerMaxEXP">100</span></div>
                        <div class="stat-bar">
                            <div class="exp-bar" id="expBar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <div>æ”»æ’ƒåŠ›: <span id="playerAttack">15</span></div>
                        <div>é˜²å¾¡åŠ›: <span id="playerDefense">5</span></div>
                    </div>
                </div>
                
                <div class="inventory">
                    <h3>ğŸ’ ã‚¢ã‚¤ãƒ†ãƒ </h3>
                    <div class="inventory-grid" id="inventoryGrid">
                        <!-- ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆã¯å‹•çš„ã«ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
        let gameState = {
            player: {
                name: "å‹‡è€…",
                level: 1,
                hp: 100,
                maxHP: 100,
                mp: 50,
                maxMP: 50,
                exp: 0,
                maxEXP: 100,
                attack: 15,
                defense: 5,
                gold: 100
            },
            inventory: [
                { name: "å›å¾©è–¬", emoji: "ğŸ§ª", count: 3, type: "heal", value: 50 },
                { name: "é­”æ³•è–¬", emoji: "ğŸ’™", count: 2, type: "mana", value: 30 }
            ],
            currentEnemy: null,
            inBattle: false,
            gameLog: []
        };

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            updatePlayerStats();
            updateInventory();
            addLog("æ–°ãŸãªå†’é™ºãŒå§‹ã¾ã£ãŸï¼");
        }

        // ãƒ­ã‚°è¿½åŠ 
        function addLog(message, type = "") {
            gameState.gameLog.push({ message, type, time: Date.now() });
            const logElement = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
            
            // ãƒ­ã‚°ãŒå¤šã™ãã‚‹å ´åˆã¯å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
            if (logElement.children.length > 20) {
                logElement.removeChild(logElement.firstChild);
            }
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆæ›´æ–°
        function updatePlayerStats() {
            const player = gameState.player;
            document.getElementById('playerName').textContent = player.name;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('playerGold').textContent = player.gold;
            document.getElementById('playerHP').textContent = player.hp;
            document.getElementById('playerMaxHP').textContent = player.maxHP;
            document.getElementById('playerMP').textContent = player.mp;
            document.getElementById('playerMaxMP').textContent = player.maxMP;
            document.getElementById('playerEXP').textContent = player.exp;
            document.getElementById('playerMaxEXP').textContent = player.maxEXP;
            document.getElementById('playerAttack').textContent = player.attack;
            document.getElementById('playerDefense').textContent = player.defense;

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼æ›´æ–°
            document.getElementById('hpBar').style.width = (player.hp / player.maxHP * 100) + '%';
            document.getElementById('mpBar').style.width = (player.mp / player.maxMP * 100) + '%';
            document.getElementById('expBar').style.width = (player.exp / player.maxEXP * 100) + '%';
        }

        // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ›´æ–°
        function updateInventory() {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = '';
            
            // 9ã‚¹ãƒ­ãƒƒãƒˆä½œæˆ
            for (let i = 0; i < 9; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                
                if (i < gameState.inventory.length) {
                    const item = gameState.inventory[i];
                    slot.className += ' has-item';
                    slot.innerHTML = `${item.emoji}<br><small>${item.count}</small>`;
                    slot.title = item.name;
                    slot.onclick = () => useItem(i);
                }
                
                grid.appendChild(slot);
            }
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨
        function useItem(index) {
            const item = gameState.inventory[index];
            if (!item) return;
            
            const player = gameState.player;
            
            if (item.type === 'heal' && player.hp < player.maxHP) {
                const healAmount = Math.min(item.value, player.maxHP - player.hp);
                player.hp += healAmount;
                addLog(`${item.name}ã‚’ä½¿ç”¨ï¼HPãŒ${healAmount}å›å¾©ã—ãŸï¼`, 'log-heal');
                
                item.count--;
                if (item.count <= 0) {
                    gameState.inventory.splice(index, 1);
                }
                
                updatePlayerStats();
                updateInventory();
            } else if (item.type === 'mana' && player.mp < player.maxMP) {
                const manaAmount = Math.min(item.value, player.maxMP - player.mp);
                player.mp += manaAmount;
                addLog(`${item.name}ã‚’ä½¿ç”¨ï¼MPãŒ${manaAmount}å›å¾©ã—ãŸï¼`, 'log-heal');
                
                item.count--;
                if (item.count <= 0) {
                    gameState.inventory.splice(index, 1);
                }
                
                updatePlayerStats();
                updateInventory();
            } else {
                addLog("ä»Šã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚");
            }
        }

        // çµŒé¨“å€¤ç²å¾—ã¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
        function gainExp(amount) {
            gameState.player.exp += amount;
            addLog(`çµŒé¨“å€¤ã‚’${amount}ç²å¾—ã—ãŸï¼`, 'log-exp');
            
            if (gameState.player.exp >= gameState.player.maxEXP) {
                levelUp();
            }
            
            updatePlayerStats();
        }

        function levelUp() {
            const player = gameState.player;
            player.level++;
            player.exp -= player.maxEXP;
            player.maxEXP = Math.floor(player.maxEXP * 1.2);
            
            const hpIncrease = Math.floor(Math.random() * 20) + 10;
            const mpIncrease = Math.floor(Math.random() * 10) + 5;
            const attackIncrease = Math.floor(Math.random() * 5) + 2;
            const defenseIncrease = Math.floor(Math.random() * 3) + 1;
            
            player.maxHP += hpIncrease;
            player.hp = player.maxHP; // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã«å…¨å›å¾©
            player.maxMP += mpIncrease;
            player.mp = player.maxMP;
            player.attack += attackIncrease;
            player.defense += defenseIncrease;
            
            addLog(`ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ãƒ¬ãƒ™ãƒ«${player.level}ã«ãªã£ãŸï¼`, 'log-exp');
            addLog(`HP+${hpIncrease}, MP+${mpIncrease}, æ”»æ’ƒåŠ›+${attackIncrease}, é˜²å¾¡åŠ›+${defenseIncrease}`);
        }

        // æ¢ç´¢é–‹å§‹
        function startExploration() {
            const events = [
                { type: 'battle', chance: 0.4 },
                { type: 'treasure', chance: 0.3 },
                { type: 'nothing', chance: 0.3 }
            ];
            
            const random = Math.random();
            let currentChance = 0;
            
            for (const event of events) {
                currentChance += event.chance;
                if (random <= currentChance) {
                    handleEvent(event.type);
                    break;
                }
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
        function handleEvent(eventType) {
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            switch (eventType) {
                case 'battle':
                    startBattle();
                    break;
                    
                case 'treasure':
                    const goldFound = Math.floor(Math.random() * 50) + 10;
                    gameState.player.gold += goldFound;
                    storyText.innerHTML = `âœ¨ å®ç®±ã‚’ç™ºè¦‹ã—ãŸï¼<br>${goldFound}ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼`;
                    addLog(`å®ç®±ã‹ã‚‰${goldFound}ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’ç²å¾—ï¼`);
                    
                    choices.innerHTML = `
                        <button class="choice-btn" onclick="startExploration()">ğŸ” ã•ã‚‰ã«æ¢ç´¢ã™ã‚‹</button>
                        <button class="choice-btn" onclick="returnToVillage()">ğŸ  æ‘ã«æˆ»ã‚‹</button>
                    `;
                    updatePlayerStats();
                    break;
                    
                case 'nothing':
                    storyText.innerHTML = `ğŸŒ² æ£®ã®ä¸­ã‚’æ­©ãå›ã£ãŸãŒã€ç‰¹ã«ä½•ã‚‚è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã€‚<br>é³¥ã®ã•ãˆãšã‚ŠãŒèã“ãˆã‚‹...`;
                    choices.innerHTML = `
                        <button class="choice-btn" onclick="startExploration()">ğŸ” ã•ã‚‰ã«æ¢ç´¢ã™ã‚‹</button>
                        <button class="choice-btn" onclick="returnToVillage()">ğŸ  æ‘ã«æˆ»ã‚‹</button>
                    `;
                    break;
            }
        }

        // ãƒãƒˆãƒ«é–‹å§‹
        function startBattle() {
            const enemies = [
                { name: "ã‚¹ãƒ©ã‚¤ãƒ ", emoji: "ğŸŸ¢", hp: 30, maxHP: 30, attack: 8, defense: 2, exp: 15, gold: 20 },
                { name: "ã‚´ãƒ–ãƒªãƒ³", emoji: "ğŸ‘¹", hp: 50, maxHP: 50, attack: 12, defense: 4, exp: 25, gold: 35 },
                { name: "ã‚ªãƒ¼ã‚¯", emoji: "ğŸ§Œ", hp: 80, maxHP: 80, attack: 18, defense: 8, exp: 40, gold: 60 }
            ];
            
            gameState.currentEnemy = enemies[Math.floor(Math.random() * enemies.length)];
            gameState.inBattle = true;
            
            addLog(`${gameState.currentEnemy.emoji} ${gameState.currentEnemy.name}ãŒç¾ã‚ŒãŸï¼`);
            updateBattleUI();
        }

        // ãƒãƒˆãƒ«UIæ›´æ–°
        function updateBattleUI() {
            const enemy = gameState.currentEnemy;
            const gameContent = document.getElementById('gameContent');
            
            gameContent.innerHTML = `
                <div class="battle-area">
                    <div class="enemy-info">
                        <h2>${enemy.emoji} ${enemy.name}</h2>
                        <div>HP: ${enemy.hp}/${enemy.maxHP}</div>
                        <div class="enemy-hp-bar">
                            <div class="enemy-hp" style="width: ${(enemy.hp / enemy.maxHP * 100)}%"></div>
                        </div>
                    </div>
                    
                    <div class="battle-actions">
                        <button class="choice-btn" onclick="playerAttack()">âš”ï¸ æ”»æ’ƒ</button>
                        <button class="choice-btn" onclick="castMagic()">âœ¨ é­”æ³•</button>
                        <button class="choice-btn" onclick="tryRun()">ğŸƒ é€ƒã’ã‚‹</button>
                        <button class="choice-btn" onclick="defend()">ğŸ›¡ï¸ é˜²å¾¡</button>
                    </div>
                </div>
            `;
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ”»æ’ƒ
        function playerAttack() {
            const player = gameState.player;
            const enemy = gameState.currentEnemy;
            
            const damage = Math.max(1, player.attack - enemy.defense + Math.floor(Math.random() * 10) - 5);
            enemy.hp -= damage;
            
            addLog(`${enemy.name}ã«${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆãŸï¼`, 'log-damage');
            
            if (enemy.hp <= 0) {
                winBattle();
            } else {
                enemyAttack();
            }
        }

        // é­”æ³•æ”»æ’ƒ
        function castMagic() {
            const player = gameState.player;
            const enemy = gameState.currentEnemy;
            
            if (player.mp < 10) {
                addLog("MPãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
                enemyAttack();
                return;
            }
            
            player.mp -= 10;
            const damage = Math.floor(player.attack * 1.5) + Math.floor(Math.random() * 15);
            enemy.hp -= damage;
            
            addLog(`ãƒ•ã‚¡ã‚¤ã‚¢ãƒœãƒ¼ãƒ«ã§${enemy.name}ã«${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`, 'log-damage');
            updatePlayerStats();
            
            if (enemy.hp <= 0) {
                winBattle();
            } else {
                enemyAttack();
            }
        }

        // é˜²å¾¡
        function defend() {
            addLog("é˜²å¾¡ã®æ§‹ãˆã‚’å–ã£ãŸï¼");
            enemyAttack(true);
        }

        // é€ƒèµ°è©¦è¡Œ
        function tryRun() {
            if (Math.random() < 0.7) {
                addLog("ã†ã¾ãé€ƒã’ã‚‹ã“ã¨ãŒã§ããŸï¼");
                gameState.inBattle = false;
                returnToVillage();
            } else {
                addLog("é€ƒã’ã‚‹ã“ã¨ãŒã§ããªã‹ã£ãŸï¼");
                enemyAttack();
            }
        }

        // æ•µã®æ”»æ’ƒ
        function enemyAttack(defending = false) {
            const player = gameState.player;
            const enemy = gameState.currentEnemy;
            
            let damage = Math.max(1, enemy.attack - player.defense + Math.floor(Math.random() * 6) - 3);
            if (defending) damage = Math.floor(damage / 2);
            
            player.hp -= damage;
            addLog(`${enemy.name}ã®æ”»æ’ƒï¼${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`, 'log-damage');
            
            if (player.hp <= 0) {
                gameOver();
            } else {
                updatePlayerStats();
                updateBattleUI();
            }
        }

        // ãƒãƒˆãƒ«å‹åˆ©
        function winBattle() {
            const enemy = gameState.currentEnemy;
            gameState.inBattle = false;
            
            addLog(`${enemy.name}ã‚’å€’ã—ãŸï¼`);
            gameState.player.gold += enemy.gold;
            addLog(`${enemy.gold}ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’ç²å¾—ã—ãŸï¼`);
            gainExp(enemy.exp);
            
            // ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—åˆ¤å®š
            if (Math.random() < 0.3) {
                const items = [
                    { name: "å›å¾©è–¬", emoji: "ğŸ§ª", type: "heal", value: 50 },
                    { name: "é­”æ³•è–¬", emoji: "ğŸ’™", type: "mana", value: 30 }
                ];
                const droppedItem = items[Math.floor(Math.random() * items.length)];
                
                // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã«è¿½åŠ 
                const existingItem = gameState.inventory.find(item => item.name === droppedItem.name);
                if (existingItem) {
                    existingItem.count++;
                } else {
                    gameState.inventory.push({...droppedItem, count: 1});
                }
                
                addLog(`${droppedItem.emoji} ${droppedItem.name}ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼`);
                updateInventory();
            }
            
            updatePlayerStats();
            returnToVillage();
        }

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        function gameOver() {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <div class="story-text">
                    ğŸ’€ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ğŸ’€<br>
                    ã‚ãªãŸã¯åŠ›å°½ãã¦ã—ã¾ã£ãŸ...<br>
                    ã—ã‹ã—ã€å†’é™ºè€…ã®é­‚ã¯ä¸æ»…ã ï¼
                </div>
                <div class="choices">
                    <button class="choice-btn" onclick="restartGame()">ğŸ”„ ã‚‚ã†ä¸€åº¦å§‹ã‚ã‚‹</button>
                </div>
            `;
        }

        // ã‚²ãƒ¼ãƒ å†é–‹
        function restartGame() {
            gameState.player.hp = gameState.player.maxHP;
            gameState.player.mp = gameState.player.maxMP;
            gameState.inBattle = false;
            gameState.currentEnemy = null;
            
            addLog("æ‘ã®è³¢è€…ã«ã‚ˆã£ã¦è˜‡ç”Ÿã•ã‚ŒãŸï¼");
            returnToVillage();
        }

        // æ‘ã«æˆ»ã‚‹
        function returnToVillage() {
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            storyText.innerHTML = `ğŸ˜ï¸ æ‘ã«æˆ»ã£ã¦ããŸã€‚<br>æ‘äººãŸã¡ãŒæ¸©ã‹ãè¿ãˆã¦ãã‚Œã‚‹ã€‚æ¬¡ã¯ã©ã†ã—ã‚ˆã†ã‹ï¼Ÿ`;
            
            choices.innerHTML = `
                <button class="choice-btn" onclick="startExploration()">ğŸŒ² æ£®ã‚’æ¢ç´¢ã™ã‚‹</button>
                <button class="choice-btn" onclick="visitShop()">ğŸª æ‘ã®åº—ã‚’è¨ªã‚Œã‚‹</button>
                <button class="choice-btn" onclick="restAtInn()">ğŸ  å®¿å±‹ã§ä¼‘ã‚€</button>
            `;
        }

        // åº—ã‚’è¨ªå•
        function visitShop() {
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            storyText.innerHTML = `ğŸ‘´ åº—ä¸»ï¼šã€Œã„ã‚‰ã£ã—ã‚ƒã„ï¼ä½•ã‹å¿…è¦ãªã‚‚ã®ã¯ã‚ã‚‹ã‹ã„ï¼Ÿã€<br>
                                  å›å¾©è–¬: 30G | é­”æ³•è–¬: 40G | ç¾åœ¨ã®æ‰€æŒé‡‘: ${gameState.player.gold}G`;
            
            choices.innerHTML = `
                <button class="choice-btn" onclick="buyItem('heal', 30)">ğŸ§ª å›å¾©è–¬ã‚’è²·ã† (30G)</button>
                <button class="choice-btn" onclick="buyItem('mana', 40)">ğŸ’™ é­”æ³•è–¬ã‚’è²·ã† (40G)</button>
                <button class="choice-btn" onclick="returnToVillage()">ğŸšª åº—ã‚’å‡ºã‚‹</button>
            `;
        }

        // ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥
        function buyItem(type, cost) {
            if (gameState.player.gold < cost) {
                addLog("ã‚´ãƒ¼ãƒ«ãƒ‰ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
                return;
            }
            
            gameState.player.gold -= cost;
            
            const items = {
                heal: { name: "å›å¾©è–¬", emoji: "ğŸ§ª", type: "heal", value: 50 },
                mana: { name: "é­”æ³•è–¬", emoji: "ğŸ’™", type: "mana", value: 30 }
            };
            
            const item = items[type];
            const existingItem = gameState.inventory.find(i => i.name === item.name);
            
            if (existingItem) {
                existingItem.count++;
            } else {
                gameState.inventory.push({...item, count: 1});
            }
            
            addLog(`${item.emoji} ${item.name}ã‚’è³¼å…¥ã—ãŸï¼`);
            updatePlayerStats();
            updateInventory();
            visitShop(); // åº—ç”»é¢ã‚’æ›´æ–°
        }

        // å®¿å±‹ã§ä¼‘ã‚€
        function restAtInn() {
            const cost = 20;
            const storyText = document.getElementById('storyText');
            const choices = document.getElementById('choices');
            
            if (gameState.player.gold >= cost) {
                storyText.innerHTML = `ğŸ›ï¸ å®¿å±‹ã®å¥³å°†ï¼šã€Œä¸€æ™©20ã‚´ãƒ¼ãƒ«ãƒ‰ã«ãªã‚Šã¾ã™ã€‚ã‚†ã£ãã‚ŠãŠä¼‘ã¿ãã ã•ã„ã€‚